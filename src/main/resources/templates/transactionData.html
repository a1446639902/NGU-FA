<!DOCTYPE html>
<html>
<head>
    <title>layUi入门</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/xadmin.css">
    <script src="../lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]-->
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>

    <link rel="stylesheet" href="../lib/layui/css/layui.css">
    <link rel="stylesheet" href="../lib/layuimini/lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../lib/layuimini/css/public.css" media="all">
    <script src="../lib/layuimini/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <script src="../lib/layuimini/js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <!--工具条-->
    <script type="text/html" id="userToolBar">
        <br/>
        <form class="layui-form layui-col-space5">
            <div class="layui-inline layui-show-xs-block">
                <label class="layui-form-label layui-bg-green" style="width: 110px;text-align: center">交易日期</label>

                <div class="layui-inline layui-show-xs-block">
                    <input class="layui-input"  autocomplete="off" placeholder="请输入交易日期" name="dateTime" id="end">
                </div>
            </div>
            <div class="layui-inline layui-show-xs-block">
                <label class="layui-form-label layui-bg-green" style="width: 110px;text-align: center">证券名称</label>

                <div class="layui-inline layui-show-xs-block">
                    <input class="layui-input" placeholder="请输入证券名称" name="securitiesName" id="equityId">
                </div>
            </div>
            <div class="layui-inline layui-show-xs-block">
                <button class="layui-btn"  lay-submit="" lay-filter="sreach" lay-event="search" ><i class="layui-icon">&#xe615;</i>搜索</button>
            </div>
        </form>
        <br>
        <div class="layui-btn-container"
             style="position: absolute; right: 120px; top: 10px;">
            <button class="layui-btn layui-btn-danger layui-btn layui-btn-sm" lay-event="deleteAll">
                <i class="layui-icon">&#xe640;</i>批量删除</button>

            <button class="layui-btn layui-btn-sm layui-btn-normal"
                    lay-event="add">
                <i class="layui-icon">&#xe654;</i>添加交易数据
            </button>
            <button class="layui-btn  layui-btn-sm" lay-event="shangHai" id="uploadShangHai"><i
                    class="layui-icon">&#xe654;</i>导入行情
            </button>
        </div>

    </script>
<body>
<button class="layui-btn  layui-btn-sm" lay-event="shangHai" id="test"><i
        class="layui-icon">&#xe654;</i>导入行情
</button>
</body>
    <script type="text/javascript">

        layui.use(['tableSelect','element', 'form', 'table', 'layer', 'laydate' ,'upload'], function () {
            var layer = layui.layer;
            var $ = layui.$;
            var table = layui.table;
            var form = layui.form;
            var tableSelect = layui.tableSelect;
            var laydate = layui.laydate;
            var upload=layui.upload;
            //执行一个laydate实例
            laydate.render({
                elem: '#end' //指定元素
            });

            laydate.render({
                elem: '#dateTime'
            })

            laydate.render({
                elem: '#dateTime'
            })

            laydate.render({
                elem: '#dateTime1'
            })

            laydate.render({
                elem: '#settlementDate'
            })
            laydate.render({
                elem: '#settlementDate1'
            })

            //文件上传
            upload.render({
                elem: '#test'
                ,url: '../TransactionData/upload' //改成您自己的上传接口
                ,data: {}
                ,accept: 'file'     //允许上传的文件类型
                ,acceptMime: 'application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                ,exts: 'xls|xlsx'   //文件后缀
                ,size: 10000           //最大允许上传的文件大小
                ,done: function(res, index, upload){ //上传后的回调
                    table.reload('userTable', layer.msg('导入成功'));
                    return;
                }
            });

            //添加证券下拉表单
            tableSelect.render({
                elem:'#securitiesName'
                ,checkedKey:'securitiesName'
                ,table:{
                    url:'../selectSecurities'
                    ,cellMinWidth: 60
                    ,cols:[
                        [
                            {type:'checkbox'},
                            {field:'securitiesId',title:'证券id'},
                            {field: 'securitiesName',title:'证券名称'},
                            {field: 'securitiesType',title: '证券类型', templet: function(item){
                                    if(item.securitiesType=='1') {
                                        return '债券';
                                    } else if(item.securitiesType=='2'){
                                        return '股票';
                                    }
                                }},
                            {field: 'exchange',title: '证券地址', templet: function(item){
                                    if(item.exchange=='1') {
                                        return '上交所';
                                    } else if(item.exchange=='2'){
                                        return '深交所';
                                    }
                                }}
                        ]
                    ]
                }
                ,done:function (elem,data) {
                    var NEWJSON = [];
                    layui.each(data.data,function (index,item) {
                        NEWJSON.push(item.securitiesName);
                        $("#securitiesId").val(item.securitiesId);
                        $("#securitiesType1").val(item.securitiesType);
                        $("#exchange1").val(item.exchange);
                    })
                    elem.val(NEWJSON.join(","));

                }
            })

            //添加现金账户下拉表单
            tableSelect.render({
                elem:'#accountName'
                ,checkedKey:'accountName'
                ,table:{
                    url:'../account/selectAccount'
                    ,cellMinWidth: 60
                    ,cols:[
                        [
                            {type:'checkbox'},
                            {field:'accountId',title:'账户编号'},
                            {field: 'accountName',title:'账户名称'}
                        ]
                    ]
                }
                ,done:function (elem,data) {
                    var NEWJSON = [];
                    layui.each(data.data,function (index,item) {
                        NEWJSON.push(item.accountName);
                        $("#accountId").val(item.accountId);
                    })
                    elem.val(NEWJSON.join(","));

                }
            })


            //添加券商下拉表单
            tableSelect.render({
                elem:'#brokersName'
                ,checkedKey:'brokersName'
                ,table:{
                    url:'../brokersSelect'
                    ,cellMinWidth: 60
                    ,cols:[
                        [
                            {type:'checkbox'},
                            {field:'brokersId',title:'券商编号'},
                            {field: 'brokersName',title:'券商名称'},
                            {field: 'brokersInstructions',title:'券商描述'}
                        ]
                    ]
                }
                ,done:function (elem,data) {
                    var NEWJSON = [];
                   layui.each(data.data,function (index,item) {
                        NEWJSON.push(item.brokersName);
                        $("#brokersId").val(item.brokersId);
                    });
                    elem.val(NEWJSON.join(","));
                    //席位名称下拉表单  通过券商显示席位
                    tableSelect.render({
                        elem:'#seateName'
                        ,checkedKey:'seateName'
                        ,table:{
                            url:'../seateSelect?brokersId=' + $("#brokersId").val()
                            ,cellMinWidth: 60
                            ,cols:[
                                [
                                    {type:'checkbox'},
                                    {field:'seateId',title:'席位编号'},
                                    {field:'seateName',title:'席位名称'},
                                    {field:'seateRate',title:'佣金利率'},
                                    {field:'brokersId',title:'券商名称'},
                                    {field: 'seateAddress',title:'地址', templet: function(item){
                                            if(item.seateAddress=='1') {
                                                return '上交所';
                                            } else if(item.seateAddress=='2'){
                                                return '深交所';
                                            }
                                        }}

                                ]
                            ]
                        }
                        ,done:function (elem,data) {
                            var NEWJSON = [];
                            layui.each(data.data,function (index,item) {
                                NEWJSON.push(item.seateName);
                                $("#seateId").val(item.seateId);
                                $("#seateRate1").val(item.seateRate);
                            })
                            elem.val(NEWJSON.join(","));

                        }
                    });

                }
            });

            //修改证券下拉表单
            tableSelect.render({
                elem:'#securitiesName2'
                ,checkedKey:'securitiesId'
                ,table:{
                    url:'../selectSecurities'
                    ,cellMinWidth: 60
                    ,cols:[
                        [
                            {type:'checkbox'},
                            {field:'securitiesId',title:'证券id'},
                            {field: 'securitiesName',title:'证券名称'},
                            {field: 'securitiesType',title: '证券类型', templet: function(item){
                                    if(item.securitiesType=='1') {
                                        return '债券';
                                    } else if(item.securitiesType=='2'){
                                        return '股票';
                                    }
                                }},
                            {field: 'exchange',title: '证券地址', templet: function(item){
                                    if(item.exchange=='1') {
                                        return '上交所';
                                    } else if(item.exchange=='2'){
                                        return '深交所';
                                    }
                                }}
                        ]
                    ]
                }
                ,done:function (elem,data) {
                    var NEWJSON = [];
                    layui.each(data.data,function (index,item) {
                        NEWJSON.push(item.securitiesName);
                        $("#securitiesId2").val(item.securitiesId);
                    })
                    elem.val(NEWJSON.join(","));

                }
            })

            //修改现金账户下拉表单
            tableSelect.render({
                elem:'#accountName2'
                ,checkedKey:'accountId'
                ,table:{
                    url:'../account/selectAccount'
                    ,cellMinWidth: 60
                    ,cols:[
                        [
                            {type:'checkbox'},
                            {field:'accountId',title:'账户编号'},
                            {field: 'accountName',title:'账户名称'}
                        ]
                    ]
                }
                ,done:function (elem,data) {
                    var NEWJSON = [];
                    layui.each(data.data,function (index,item) {
                        NEWJSON.push(item.accountName);
                        $("#accountId2").val(item.accountId);
                    })
                    elem.val(NEWJSON.join(","));

                }
            })

            //修改券商下拉表单
            tableSelect.render({
                elem:'#brokersName2'
                ,checkedKey:'brokersName'
                ,table:{
                    url:'../brokersSelect'
                    ,cellMinWidth: 60
                    ,cols:[
                        [
                            {type:'checkbox'},
                            {field:'brokersId',title:'券商编号'},
                            {field: 'brokersName',title:'券商名称'},
                            {field: 'brokersInstructions',title:'券商描述'}
                        ]
                    ]
                }
                ,done:function (elem,data) {
                    //alert("选中的数据：" + data);
                    var NEWJSON = [];
                    layui.each(data.data,function (index,item) {
                        NEWJSON.push(item.brokersName);
                        $("#brokersId2").val(item.brokersId);
                    });
                    elem.val(NEWJSON.join(","));
                    //席位名称下拉表单
                    tableSelect.render({
                        elem:'#seateName2'
                        ,checkedKey:'seateName'
                        ,table:{
                            url:'../seateSelect?brokersId=' + $("#brokersId2").val()
                            ,cellMinWidth: 60
                            ,cols:[
                                [
                                    {type:'checkbox'},
                                    {field:'seateId',title:'席位编号'},
                                    {field:'seateName',title:'席位名称'},
                                    {field:'seateRate',title:'佣金利率'},
                                    {field:'brokersId',title:'券商名称'},
                                    {field: 'seateAddress',title:'地址', templet: function(item){
                                            if(item.seateAddress=='1') {
                                                return '上交所';
                                            } else if(item.seateAddress=='2'){
                                                return '深交所';
                                            }
                                        }}

                                ]
                            ]
                        }
                        ,done:function (elem,data) {
                            var NEWJSON = [];
                            layui.each(data.data,function (index,item) {
                                NEWJSON.push(item.seateName);
                                $("#seateId2").val(item.seateId);
                                $("#seateRate2").val(item.seateRate);
                            })
                            elem.val(NEWJSON.join(","));

                        }
                    });

                }
            });


            //新增提交
            form.on('submit(addsubmit)', function(data){
                var formData=$('#addform').serialize();
                /*alert("表单提交的数据：" + formData);*/
                $.post("../TransactionData/insertTransactionData",formData,function(msg){
                    if(msg>0){
                        table.reload('userTable');
                        layer.closeAll();
                        layer.msg('添加成功',{
                            title : '提示',
                            area : [ '200px',
                                '140px' ],
                            time : 0,
                            btn : [ '知道了' ]
                        });
                    }else{
                        layer.closeAll();
                        layer.msg('添加失败',{
                            title : '提示',
                            area : [ '200px',
                                '140px' ],
                            time : 0,
                            btn : [ '知道了' ]
                        });
                    }
                });
               //$("#addsubmit").reset();
                return false;
            });
            //修改提交
            form.on('submit(editsubmit)', function(data){
                var formData=$('#editform').serialize();
                $.post("../TransactionData/updateTransactionData",formData,function(msg){
                    if(msg>0){
                        table.reload('userTable');
                        layer.closeAll();
                        layer.msg('修改成功',{
                            title : '提示',
                            area : [ '200px',
                                '140px' ],
                            time : 0,
                            btn : [ '知道了' ]
                        });
                    }else{
                        layer.closeAll();
                        layer.msg('修改失败',{
                            title : '提示',
                            area : [ '200px',
                                '140px' ],
                            time : 0,
                            btn : [ '知道了' ]
                        });
                    }
                });
                return false;
            });

            table.render({
                elem: '#userTable',
                url: '../TransactionData/selectTransactionData',
                page: true,
                height: 'full-30',
                toolbar: '#userToolBar',//显示在表头的工具条
                minLength:80,
                cols: [
                    [ //表头
                    {type: 'checkbox', fixed: 'left'}
                    ,{field: 'transactionDataId', title: '交易单号', width: 130, align:'center',hide:true}
                    ,{field: 'accountName', title: ' 现金账户', width: 130, align:'center'}
                    ,{field: 'securitiesName', title: ' 证券名称', width: 130, align:'center'}
                    ,{field: 'brokersName', title: '券商名称', width: 130, align:'center'}
                    ,{field: 'dateTime', title: '交易日期', width:130, align:'center'}
                    ,{field: 'num', title: '交易数量', width: 130, align:'center'}
                    ,{field: 'price', title: '交易单价', width:130, align:'center'}
                    ,{field: 'netReceipts', title: '交易金额', width:130, align:'center'}
                    ,{field: 'totalSum', title: '结算金额', width: 130, align:'center'}
                    ,{field: 'settlementDate', title: '结算日期', width: 130, align:'center'}
                    ,{field: 'fundId', title: '基金代码', width: 130, align:'center',hide:true}
                    ,{field: 'fundName', title: '基金名称', width: 130, align:'center',hide:true}
                    ,{field: 'securitiesId', title: '证券ID', width: 130, align:'center',hide:true}
                    ,{field: 'brokersId', title: '券商ID', width: 130, align:'center',hide:true}
                    ,{field: 'brokersName', title: '券商名称', width: 130, align:'center',hide:true}
                    ,{field: 'seateId', title: '席位ID', width: 130, align:'center',hide:true}
                    ,{field: 'seateName', title: '席位名称', width: 130, align:'center',hide:true}
                    ,{field: 'accountId', title: '现金账户ID', width: 130, align:'center',hide:true}
                    ,{field: 'blankName', title: '银行名称', width: 130, align:'center',hide:true}
                    ,{field: 'flag', title: '交易表示符1流入,-1流出', width: 130, align:'center',hide:true}
                    ,{field: 'commission', title: '佣金费用', width: 130, align:'center',hide:true}
                    ,{field: 'transfer', title: '过户费', width: 130, align:'center',hide:true}
                    ,{field: 'brokerage', title: '经手费', width: 130, align:'center',hide:true}
                    ,{field: 'stamp', title: '印花税', width: 130, align:'center',hide:true}
                    ,{field: 'management', title: '征管费', width: 130, align:'center',hide:true}
                    ,{field: 'security', title: '证券利息', width: 130, align:'center',hide:true}
                    ,{field: 'transactionDataDesc', title: '备注', width: 130, align:'center',hide:true}
                    ,{field: 'transactionDataMode', title: '交易方式', width: 130, align:'center', templet: function(item){
                        if(item.transactionDataMode=='1') {
                                return '买入';
                            } else if(item.transactionDataMode=='2'){
                                return '卖出';
                            } else if(item.transactionDataMode=='3'){
                                return '分红';
                            } else if(item.transactionDataMode=='4'){
                                return '送股';
                            }
                        }
                    }
                    ,{field: 'status', title: '交易状态', width: 130, align:'center', templet: function(item){
                            if(item.status=='0') {
                                return '未结算';
                            } else if(item.status=='1'){
                                return '已结算';
                            }
                        }
                    }
                    ,{fixed: 'right', title: '操作' , width: 160, align:'center',toolbar:'#barDemo'}
                ]
                ]
            });
            //给工具条的按钮添加事件
            table.on('toolbar(userTable)',function (obj) {
                //获取选中复选框的对象，
                var checkStatus=table.checkStatus(obj.config.id);//得到表格选中行的ID
                switch (obj.event) {
                    case 'add':
                        var index=layer.open({
                            type: 1,
                            title: '添加数据信息',
                            closeBtn: 1,
                            move:false,
                            area: ['893px','600px'],
                            content:$("#addContent"),
                            btn:[]
                        });
                        form.render();
                        break;
                    case 'search':
                        //alert("搜索");
                        var dateTime= $("#end").val();
                        var securitiesName= $("#equityId").val();
                        //表格的重新加载事件
                        table.reload('userTable', {
                            method: 'post'
                            , where: {
                                'dateTime': dateTime,
                                'securitiesName': securitiesName
                            }
                            , page: {
                                curr: 1
                            }
                        });

                        //执行一个laydate实例
                        laydate.render({
                            elem: '#end' //指定元素
                        });

                        break;
                    case 'deleteAll':
                        var data = checkStatus.data;

                        if(data.length==0){
                            layer.msg("请至少选择一条数据",)
                        }else
                        {
                            var ids=[];
                            for (var i = 0; i <data.length; i++) {
                                ids.push(data[i].transactionDataId);
                            }
                            layer.confirm('真的删除行么',{icon: 2}, function(index){
                                layer.close(index);
                                //layer.alert(JSON.stringify(data));
                                $.post("../TransactionData/deleteTransactionDataTwo", {transactionDataId:ids.join(',')},function(msg){
                                    table.reload('userTable');
                                    layer.msg('删除'+checkStatus.data.length+'条记录', {
                                        title:'提示',
                                        area: ['200px', '140px'],
                                        time: 0,
                                        btn: ['知道了']
                                    });
                                });
                            });
                        }
                        break;
                }
            });
            //给表格编辑，删除按钮添加点击事件
            table.on('tool(userTable)', function(obj) {
                var data = obj.data;//得到行整行的数据
                //alert(data.transactionDataId);
                if (data.status==1){
                    layer.msg('已处理业务无法删除或修改');
                }else if (data.status==0) {
                    if (obj.event === 'del') {
                        layer.confirm('真的删除行么',{icon: 2}, function(index){
                            layer.close(index);
                            $.post("../TransactionData/deleteTransactionData", {transactionDataId:data.transactionDataId+""},function(msg){
                                table.reload('userTable');
                            });
                        });
                    } else if (obj.event === 'edit') {
                        //alert(JSON.stringify(data));
                        form.val('editform',$.parseJSON(JSON.stringify(data)));
                        var index = layer.open({
                            type: 1,
                            title: '修改交易数据',
                            closeBtn: 1,
                            move:false,
                            area: ['893px','600px'],
                            content:$('#editContent')
                        });
                        form.render();
                        //全屏弹窗 layer.full(index);
                    };
                }
            })

        });

        //取消事件
        function myclose() {
            layer.closeAll();
        }
        //添加

        function myNum() {
            var lixidays=0;
            layui.use(['layer'], function () {
                var $ = layui.$;
                //交易金额 = 数量*价格
                var num = document.getElementById("num").value;
                var price = document.getElementById("price").value;
                var netReceipts = Number(num) * Number(price);
                $("#netReceipts").val(netReceipts);

                //佣金费用 = 交易金额*席位佣金利率
                var seateRate1=document.getElementById("seateRate1").value;
                var netReceipts1=document.getElementById("netReceipts").value;
                var commission=Number(seateRate1)*Number(netReceipts1);
                $("#commission").val(commission/100);
                //securitiesId
                var securitiesId =document.getElementById("securitiesId").value;
                var securitiesType1=document.getElementById("securitiesType1").value;
                var exchange1=document.getElementById("exchange1").value;

                $.post("../selectVarietiesRate", {exchangeName: exchange1,rateType: securitiesType1,page:1,limit:1},function(obj){
                    $.each(obj.data,function (index,item) {
                        $('#stampDuty1').val(item.stampDuty);
                        $('#transferFee1').val(item.transferFee);
                        $('#collectionRate1').val(item.collectionRate);
                        $('#brokerage1').val(item.brokerage);
                        //证券利息：股票和债券都属于证券
                        //股票没有利息，债券利息就是债券


                        $.post("../selectBond", {securitiesId: securitiesId,drawStartDate: '',page:1,limit:1},function(obj2) {
                            $.each(obj2.data,function (index2,item2){
                                //  票面利率/365*票面金额*数量*1
                                //票面利率
                                var lixiday = Number(item2.parRate)/365*Number(item2.bondRateAmount)*Number(num)*1;
                                lixidays = lixiday.toFixed(2);
                                $('#security1').val(lixidays);
                            })
                        })
                        var vals=0;
                        if (item.rateType==1){
                            vals = $('#security1').val();
                        }else if (item.rateType==2){
                            $('#security1').val(0);
                        }
                        alert(vals)
                        var totalSum=0;
                        //买入
                        if ($('#transactionDataMode').val()==1){
                            totalSum=Number(netReceipts)+Number(commission)/100+Number(item.stampDuty)
                            +Number(item.transferFee)+Number(item.collectionRate)+Number(item.brokerage)+Number(vals);
                            //var floatSum=parseFloat(totalSum);
                            var ser=totalSum.toFixed(2);
                            $('#totalSum').val(ser);
                            //卖出
                        }else if($('#transactionDataMode').val()==2){
                            $('#totalSum').val(netReceipts-(commission/100+item.stampDuty
                                +item.transferFee+item.collectionRate+item.brokerage)+vals);
                        }
                    })

                });
            })
        }

    //修改
        function myNum2() {
            layui.use(['layer'], function () {
                var $ = layui.$;
                //交易金额 = 数量*价格
                var num2 = document.getElementById("num2").value;
                var price2 = document.getElementById("price2").value;
                var netReceipts2 = Number(num2) * Number(price2);
                $("#netReceipts2").val(netReceipts2);

                //佣金费用 = 交易金额*席位佣金利率
                var seateRate2=document.getElementById("seateRate2").value;
                var netReceipts2=document.getElementById("netReceipts2").value;
                var commission2=Number(seateRate2)*Number(netReceipts2);
                $("#commission2").val(commission2/100);
                //securitiesId
                var securitiesId2 =document.getElementById("securitiesId2").value;
                var securitiesType2=document.getElementById("securitiesType2").value;
                var exchange2=document.getElementById("exchange2").value;

                $.post("../selectVarietiesRate", {exchangeName: exchange2,rateType: securitiesType2,page:1,limit:1},function(obj){
                    $.each(obj.data,function (index,item) {
                        $('#stampDuty2').val(item.stampDuty);
                        $('#transferFee2').val(item.transferFee);
                        $('#collectionRate2').val(item.collectionRate);
                        $('#brokerage2').val(item.brokerage);
                        //证券利息：股票和债券都属于证券
                        //股票没有利息，债券利息就是债券
                        var parRate2=0;
                        var bondRateAmount2=0;
                        var lixiday=0;
                        $.post("../selectBond", {securitiesId: securitiesId2,drawStartDate: '',page:1,limit:1},function(obj2) {
                            $.each(obj2.data,function (index2,item2){
                                //  票面利率/365*票面金额*数量*1
                                //票面利率
                                parRate2 = item2.parRate;
                                //票面金额
                                bondRateAmount2 = item2.bondRateAmount;
                            })
                        })
                        //当天应收债券利息
                        lixiday = parRate2/365*bondRateAmount2*num2*1;

                        //股票没有利息
                        if (item.rateType==2){
                            lixiday=0;
                            $('#security2').val(lixiday);
                        }else if (item.rateType==1){
                            $('#security2').val(lixiday);
                        }
                        //买入   结算金额
                        if ($('#transactionDataMode2').val()==1){
                            var totalSum=Number(netReceipts2)+Number(commission2)/100+Number(item.stampDuty)
                                +Number(item.transferFee)+Number(item.collectionRate)+Number(item.brokerage)+Number(lixiday);
                            var ser=totalSum.toFixed(2);
                            $('#totalSum2').val(ser);
                            //卖出
                        }else if($('#transactionDataMode2').val()==2){
                            $('#totalSum2').val(netReceipts2-(commission2/100+item.stampDuty
                                +item.transferFee+item.collectionRate+item.brokerage)+lixiday);
                        }
                    })

                });
            })
        }


    </script>
</head>
<body style="overflow: auto; background-color: white;"
      class="layui-view-body layui-content">
<div>
    <!--表格-->
    <table id="userTable" lay-filter="userTable"></table>
    <!--工具条-->
    <div style="display: none;" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit"><i
                class="layui-icon">&#xe642;</i>编辑</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i
                class="layui-icon">&#xe640;</i>删除</a>

    </div>
</div>


<!--增加的div内容-->
<div id="addContent" style="display: none; height: 100%; width:100%; text-align: center">
    <form id="addform" lay-filter="addform" class="layui-form layui-col-space5" style="margin: 50px auto; display: inline-block;">
        <div>
            <input type="hidden" name="transactionDataId">
            <input type="hidden" name="securitiesId" id="securitiesId">
            <input type="hidden" name="fundId">
            <input type="hidden" name="fundName">
            <input type="hidden" name="accountId" id="accountId">
            <input type="hidden" name="brokersId" id="brokersId">
            <input type="hidden" name="seateId" id="seateId">
            <input type="hidden" name="blankName">
            <input type="hidden" name="transactionDataDesc">
            <input type="hidden" name="seateRate1" id="seateRate1">
            <input type="hidden" name="securitiesType1" id="securitiesType1">
            <input type="hidden" name="exchange1" id="exchange1">
        </div>

        <div class="layui-inline layui-show-xs-block" style="text-align: center;">
            <label class="layui-form-label layui-bg-green" style="text-align: center">证券编号</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="证券ID" name="securitiesName" id="securitiesName">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">账户编号</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="账户ID" name="accountName" id="accountName">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">券商名称</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="券商ID" name="brokersName" id="brokersName">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">席位名称</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="席位ID" name="seateName" id="seateName">
            </div>
        </div>
        <br>
        <br>

        <div class="grid-demo grid-demo-bg1">
            <div class="layui-form-item" >
                <label class="layui-form-label layui-bg-green" style="text-align: center">交易方式</label>
                <div class="layui-input-inline">
                    <select name="transactionDataMode" lay-verify="required" id="transactionDataMode">
                        <option value="1">买入</option>
                        <option value="2">卖出</option>
                        <option value="3">分红</option>
                        <option value="4">送股</option>
                    </select>
                </div>
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">成交日期</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="请输入成交日期" name="dateTime" id="dateTime">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">交易价格</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入交易价格" name="price" id="price" >
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">结算日期</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="请输入结算日期" name="settlementDate" id="settlementDate">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">交易数量</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入交易数量" name="num" id="num" onblur="myNum()">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block" style="float: left">
            <label class="layui-form-label layui-bg-green" style="text-align: center">交易金额</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="请输入交易金额" name="netReceipts" id="netReceipts">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">结算金额</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入结算金额" name="totalSum" id="totalSum">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">佣金费用</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入佣金费用" name="commission" id="commission" >
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">过户费</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入过户费" name="transfer" id="transferFee1">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">印花税</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入印花税" name="stamp" id="stampDuty1">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">征管费</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入征管费" name="management" id="collectionRate1">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">经手费</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入经手费" name="brokerage" id="brokerage1">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">证券利息</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入证券利息" name="security" id="security1">
            </div>
        </div>

        <div style="position: absolute; left: 39%; top: 650px">
            <button class="layui-btn" lay-submit=""  lay-filter="addsubmit">
                <i class="layui-icon">&#x1005;</i>添加
            </button>
            <button class="layui-btn layui-bg-red cancel" type="button" onclick="myclose()">
                <i class="layui-icon">&#x1006;</i>取消
            </button>
        </div>
    </form>
</div>



<!--修改的div内容-->
<div id="editContent"
     style="display: none; height: 100%; height: 100%; text-align: center;">
    <form id="editform" lay-filter="editform" class="layui-form layui-form-pane" style="margin: 30px auto; display: inline-block;">
        <div>
            <input type="hidden" name="transactionDataId">
            <input type="hidden" name="securitiesId" id="securitiesId2">
            <input type="hidden" name="fundId">
            <input type="hidden" name="fundName">
            <input type="hidden" name="accountId" id="accountId2">
            <input type="hidden" name="brokersId" id="brokersId2">
            <input type="hidden" name="seateId" id="seateId2">
            <input type="hidden" name="blankName">
            <input type="hidden" name="transactionDataDesc">
            <input type="hidden" name="seateRate2" id="seateRate2">
            <input type="hidden" name="securitiesType2" id="securitiesType2">
            <input type="hidden" name="exchange2" id="exchange2">
        </div>

        <div class="layui-inline layui-show-xs-block" style="text-align: center;">
            <label class="layui-form-label layui-bg-green" style="text-align: center">证券编号</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="证券ID" name="securitiesName" id="securitiesName2">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">账户编号</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="账户ID" name="accountName" id="accountName2">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">券商名称</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="券商ID" name="brokersName" id="brokersName2">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">席位名称</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="席位ID" name="seateName" id="seateName2">
            </div>
        </div>
        <br>
        <br>

        <div class="grid-demo grid-demo-bg1">
            <div class="layui-form-item" >
                <label class="layui-form-label layui-bg-green" style="text-align: center">交易方式</label>
                <div class="layui-input-inline">
                    <select name="transactionDataMode" lay-verify="required" id="transactionDataMode2">
                        <option value="1">买入</option>
                        <option value="2">卖出</option>
                        <option value="3">分红</option>
                        <option value="4">送股</option>
                    </select>
                </div>
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">成交日期</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="请输入成交日期" name="dateTime" id="dateTime1">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">交易价格</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入交易价格" name="price" id="price2">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">结算日期</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="请输入结算日期" name="settlementDate" id="settlementDate1">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">交易数量</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入交易数量" name="num" id="num2" onblur="myNum2()">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block" style="float: left">
            <label class="layui-form-label layui-bg-green" style="text-align: center">交易金额</label>
            <div class="layui-inline layui-show-xs-block">
                <input class="layui-input" placeholder="请输入交易金额" name="netReceipts" id="netReceipts2" >
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">结算金额</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入结算金额" name="totalSum" id="totalSum2">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">佣金费用</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入佣金费用" name="commission" id="commission2">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp

        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">过户费</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入过户费" name="transfer" id="transferFee2">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">印花税</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入印花税" name="stamp" id="stampDuty2">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">征管费</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入征管费" name="management" id="collectionRate2">
            </div>
        </div>
        <br>
        <br>
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">经手费</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入经手费" name="brokerage" id="brokerage2">
            </div>
        </div>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        <div class="layui-inline layui-show-xs-block">
            <label class="layui-form-label layui-bg-green" style="text-align: center">证券利息</label>
            <div class="layui-inline layui-show-xs-block" style="width: 182px">
                <input class="layui-input" placeholder="请输入证券利息" name="security" id="security2">
            </div>
        </div>

        <div style="position: absolute;  left: 39%; top: 550px">
            <button class="layui-btn" lay-submit="" lay-filter="editsubmit">
                <i class="layui-icon">&#x1005;</i>修改
            </button>
            <button class="layui-btn layui-bg-red cancel" type="button" onclick="myclose()">
                <i class="layui-icon">&#x1006;</i>取消
            </button>
        </div>
    </form>
</div>
</body>
</html>
