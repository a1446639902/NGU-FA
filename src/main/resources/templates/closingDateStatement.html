<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>成交结算日报表</title>
    <link type="text/css" rel="stylesheet" href="../lib/layui/css/layui.css"/>
    <script type="text/javascript" src="../lib/layui/layui.js"></script>
    <!--表格头文件-->
    <script type="text/html" id="userToolBar">
        <form class="layui-form layui-col-space5" >
            <div class="layui-inline layui-show-xs-block">
                <label class="layui-form-label layui-bg-green" style="width: 100px;text-align: center">成交日期</label>
                <div class="layui-inline layui-show-xs-block">
                    <input class="layui-input" autocomplete="off"  placeholder="请选择日期" name="start" id="start" >
                </div>
            </div>
            <div class="layui-inline layui-show-xs-block">
                <button class="layui-btn"  lay-submit lay-event="search" lay-filter="search" id="searchId"><i class="layui-icon">&#xe615;</i>搜索</button>
            </div>
        </form>

    </script>

    <script type="text/javascript">
        layui.use(['table', 'form', 'layer','laydate'], function () {
            var table = layui.table;
            var form = layui.form;
            var layer = layui.layer;
            var laydate=layui.laydate;
            var $ = layui.$;
            laydate.render({
                elem:'#start'
            });


            table.render({
                elem: '#myTable' //实例化表格的ID名称
                , url: '../selectClosingDateStatement'   //接收JSON数据的路径
                , toolbar: '#userToolBar' //开启头部工具栏，并为其绑定左侧模板
                , title: '用户数据表'//表格名称
                , cellMinWidth: 100
                , height:'full-30'
                , cols:[
                    [
                         {field : 'securitiesId', align: 'center', title : '证券代码', width:120}
                        ,{field : 'securitiesName', align: 'center', title : '证券名称', width:120}
                        ,{field : 'num', title : '交易数量', align: 'center', width:110,
                                templet :function(i){
                                    if(i.securitiesId=='流入合计' ){
                                        return '';
                                        }
                                    if(i.securitiesId=='流出合计'){
                                        return '';
                                        }
                                    if( i.securitiesId=='清算合计'){
                                        return '';
                                        }
                                    else{
                                        return i.num;
                                        }
                                    }}
                        ,{field : 'netReceipts', title : '交易金额', align: 'center' , width:110,
                                templet :function(i){
                                    if(i.securitiesId=='流入合计' ){
                                        return '';
                                        }
                                    if(i.securitiesId=='流出合计'){
                                        return '';
                                        }
                                    if( i.securitiesId=='清算合计'){
                                        return '';
                                        }
                                    else{
                                        return i.totalSum;
                                         }
                                }}
                        ,{field : 'commission', title : '佣金费率', align: 'center', width:110,
                        templet :function(i){
                            if(i.securitiesId=='流入合计' ){
                                return '';
                            }
                            if(i.securitiesId=='流出合计'){
                                return '';
                            }
                            if( i.securitiesId=='清算合计'){
                                return '';
                            }
                            else{
                                return i.totalSum;
                            }
                        }}
                    ,{field : 'stamp', title : '印花税', align: 'center', width:110,
                        templet :function(i){
                            if(i.securitiesId=='流入合计' ){
                                return '';
                            }
                            if(i.securitiesId=='流出合计'){
                                return '';
                            }
                            if( i.securitiesId=='清算合计'){
                                return '';
                            }
                            else{
                                return i.totalSum;
                            }
                        }}
                    ,{field : 'brokerage', title:'经手费', width:110, align: 'center',
                        templet :function(i){
                            if(i.securitiesId=='流入合计' ){
                                return '';
                            }
                            if(i.securitiesId=='流出合计'){
                                return '';
                            }
                            if( i.securitiesId=='清算合计'){
                                return '';
                            }
                            else{
                                return i.totalSum;
                            }
                        }}
                    , {field : 'transfer', title:'过户费', width:110, align: 'center',
                        templet :function(i){
                            if(i.securitiesId=='流入合计' ){
                                return '';
                            }
                            if(i.securitiesId=='流出合计'){
                                return '';
                            }
                            if( i.securitiesId=='清算合计'){
                                return '';
                            }
                            else{
                                return i.totalSum;
                            }
                        }}
                    ,{field : 'flag', title:'交易标识', align: 'center', hide:true}
                    ,{field : 'securitiesType', title:'证券类型', align: 'center', hide:true}
                    ,{field : 'management', title:'征管费', width:110, align: 'center',
                        templet :function(i){
                            if(i.securitiesId=='流入合计' ){
                                return '';
                            }
                            if(i.securitiesId=='流出合计'){
                                return '';
                            }
                            if( i.securitiesId=='清算合计'){
                                return '';
                            }
                            else{
                                return i.totalSum;
                            }
                        }}
                    ,{field : 'security', title:'国债利息', width:110, align: 'center' ,
                        templet :function(i){
                            if(i.securitiesId=='流入合计' ){
                                return '';
                            }
                            if(i.securitiesId=='流出合计'){
                                return '';
                            }
                            if( i.securitiesId=='清算合计'){
                                return '';
                            }
                            else{
                                return i.totalSum;
                            }
                        }}
                    ,{field : 'totalSum', title:'实际清算金额', width:130, align: 'center',
                        templet :function(items){
                            if(items.netReceipts!=null){
                                if(items.flag==-1){
                                    return	 "<span style='color:#ff0000;'>"+fmoney(items.netReceipts,2)+"</span>";
                                }
                                if(items.securitiesId=='流出合计'){
                                    return	 "<span style='color:red;'>"+fmoney(items.netReceipts,2)+"</span>";
                                }
                                if(items.netReceipts<0){
                                    return	 "<span style='color:red;'>"+fmoney(items.netReceipts,2)+"</span>";

                                }
                                return fmoney(items.netReceipts,2);
                            }else{
                                return 0;
                            }
                        }}
                    ,{field : 'transactionDataMode', title:'业务类型', width:110, align: 'center',
                        templet :function(item){
                            if(item.modes==1&&item.securitiesType==1){
                                return '买入债券'
                            }if(item.modes==2&&item.securitiesType==1){
                                return '卖出债券'
                            }if(item.modes==3){
                                return '分红'
                            }if(item.modes==4){
                                return '送股'
                            }
                            if(item.modes==0){
                                return ' '
                            }
                            if(item.modes==1&&item.securitiesType==2){
                                return '买入股票'
                            }if(item.modes==2&&item.securitiesType==2){
                                return '卖出股票'
                            }
                        }
                    }
                 ]
                ]
                , page: true//开启分页
            });
            //给工具条的按钮添加事件
            table.on('toolbar(myTable)', function (obj) {
                var userName = $("#userName").val();
                switch (obj.event) {
                    case "search":
                        var blankName=$('#blankName').val();
                        var accountName=$('#accountName').val();
                        table.reload('myTable', {
                            method: 'post',
                            page: {
                                curr: 1
                            },
                            where:{
                                'blankName':blankName,
                                'accountName':accountName
                            }
                        });
                        break;

                    case "add":
                        layer.open({
                            type: 1,
                            title: '新增现金账户信息',
                            area: ['893px', '550px'],
                            content: $("#addContent")
                        });
                        break;
                    //删除多行
                    case "deleteAll":
                        //获得选中的对象
                        var checkStatus = table.checkStatus("myTable"); //idTest 即为基础参数 id 对应的值
                        // 其中 ID 为基础参数 id 对应的值（见：设定容器唯一ID）
                        var accountIds = [];
                        var dataArr = checkStatus.data; //获取选中行的数据
                        $.each(dataArr, function (i, n) {
                            accountIds.push(n.accountId);
                        });
                        if (dataArr.length == 0) {
                            layer.msg("请先选中数据");
                        }
                        else {
                            layer.confirm('真的删除行么', function () {
                                layer.close();
                                //向服务端发送删除指令
                                $.post("../account/deleteAccount","accountId="+accountIds,function(msg){
                                    if(msg>0){
                                        table.reload('myTable');
                                        layer.closeAll();
                                        layer.msg('删除成功',{
                                            title : '提示',
                                            area : [ '200px',
                                                '140px' ],
                                            time : 0,
                                            btn : [ '知道了' ]
                                        });
                                    }
                                    else{
                                        layer.closeAll();
                                        layer.msg('删除失败',{
                                            title : '提示',
                                            area : [ '200px',
                                                '140px' ],
                                            time : 0,
                                            btn : [ '知道了' ]
                                        });
                                    }
                                });
                                return false;
                            });
                        }
                        break;
                }
            });
            //给表格编辑，删除按钮添加点击事件
            table.on('tool(myTable)', function(obj) { //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）

                if (layEvent === 'del') { //删除
                    layer.confirm('真的删除行么', function (index) {
                        obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                        layer.close(index);
                        //向服务端发送删除指令
                        $.post("../account/deleteAccount", "accountId="+data.accountId,function(msg){
                            if(msg>0){
                                table.reload('myTable');
                                layer.closeAll();
                                layer.msg('删除成功',{
                                    title : '提示',
                                    area : [ '200px',
                                        '140px' ],
                                    time : 0,
                                    btn : [ '知道了' ]
                                });
                            }else{
                                layer.closeAll();
                                layer.msg('删除失败',{
                                    title : '提示',
                                    area : [ '200px',
                                        '140px' ],
                                    time : 0,
                                    btn : [ '知道了' ]
                                });
                            }

                        });
                        return false;
                    });
                }
                else if(layEvent=="edit"){
                    form.val("editform",data);//第二个参数可以是json字符串也可以是json对象
                    layer.open({
                        type: 1,
                        title: '修改用户信息',
                        area: ['893px', '550px'],
                        content: $("#editContent")
                    });

                }

            });
            //新增提交
            form.on('submit(addsubmit)', function(data){
                var accounts=$('#addform').serialize();
                var addopen=new Date($('#addopen').val()).getTime();//获得开户日期
                var addend=new Date($('#addend').val()).getTime();//获得结束日期
                if(addopen>addend){
                    layer.msg("开户日期不能先于结束日期。请重新选择");
                }
                else {
                    $.post("../account/insertAccount", accounts, function (msg) {
                        if (msg > 0) {
                            table.reload('myTable');
                            layer.closeAll();
                            layer.msg('添加成功', {
                                title: '提示',
                                area: ['200px',
                                    '140px'],
                                time: 0,
                                btn: ['知道了']
                            });
                        } else {
                            layer.closeAll();
                            layer.msg('添加失败', {
                                title: '提示',
                                area: ['200px',
                                    '140px'],
                                time: 0,
                                btn: ['知道了']
                            });
                        }
                    });
                }
                    $("#addform")[0].reset();
                    return false;

            });


            //修改提交
            form.on('submit(editsubmit)',function () {
                var data = $('#editform').serialize();//获取表单区域所有值
                $.post("../account/updateAccount",data,function(msg){
                    if(msg>0){
                        table.reload('myTable');
                        layer.closeAll();
                        layer.msg('修改成功',{
                            title : '提示',
                            area : [ '200px',
                                '140px' ],
                            time : 0,
                            btn : [ '知道了' ]
                        });
                    }else{
                        layer.closeAll();
                        layer.msg('修改失败',{
                            title : '提示',
                            area : [ '200px',
                                '140px' ],
                            time : 0,
                            btn : [ '知道了' ]
                        });
                    }

                });
                return false;//解决弹出层闪退问题
            });

        })
        function myclose() {
            layer.closeAll();
        }
    </script>
</head>
<body>

<table id="myTable" lay-filter="myTable"></table>
<!--表格里的编辑删除按钮-->
<div style="display: none;" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit"><i
            class="layui-icon">&#xe642;</i>编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del"><i
            class="layui-icon">&#xe640;</i>删除</a>
</div>
<!--添加现金账号div的内容-->
<div id="addContent"
     style="display: none; height: 100%; height: 100%; text-align: center;">
    <form id="addform" lay-filter="addform"
          class="layui-form layui-form-pane"
          style="margin: 30px auto; display: inline-block;">
        <div class="layui-row">
            <div class="layui-col-xs6">
                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >银行卡号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="blankCardCode" lay-verify="required"
                               autocomplete="off" placeholder="请输入银行卡号" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >银行名称</label>
                    <div class="layui-input-inline">
                        <select name="blankName">
                            <option value="">请选择</option>
                            <option value="中国银行" selected>中国银行</option>
                            <option value="建设银行">建设银行</option>
                            <option value="工商银行">工商银行</option>
                            <option value="农业银行">农业银行</option>
                        </select>
                        <!-- <input type="text" name="blankName" lay-verify="required"
                                autocomplete="off" placeholder="请输入账户名称" class="layui-input">-->
                    </div>
                </div>
                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >开户时间</label>
                    <div class="layui-input-inline">
                        <input autocomplete="off" id="addopen" name="openTime" lay-verify="required"
                               placeholder="请选择日期" class="layui-input">
                    </div>
                </div>


                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >卡号利率</label>
                    <div class="layui-input-inline">
                        <input type="text" name="cardRate" lay-verify="required"
                               autocomplete="off" placeholder="请输入利率%" class="layui-input">
                    </div>
                </div>

            </div>
            <div class="layui-col-xs6">

                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >账户名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="accountName" lay-verify="required"
                               autocomplete="off" placeholder="请输入账户名称" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >存款类型</label>
                    <div class="layui-input-inline">
                        <select name="deposit">
                            <option value="">请选择</option>
                            <option value="1">活期</option>
                            <option value="2">定期</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >结束时间</label>
                    <div class="layui-input-inline">
                        <input autocomplete="off" id="addend" name="endTime" lay-verify="required"
                               placeholder="请选择日期" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item" style="text-align: center;">
                    <label class="layui-form-label layui-bg-green" >计息期间</label>
                    <div class="layui-input-inline">
                        <select  name="procisionDays">
                            <option value="">请选择</option>
                            <option value="1">360天</option>
                            <option value="2">365天</option>
                            <option value="3">366天</option>
                        </select>
                    </div>
                </div>

            </div>
        </div>
        <div class="layui-form-item" style="text-align: center;">
            <div class="layui-input-inline">
                <textarea name="accountDesc" style="width: 590px;height: 100px;padding: 10px;" rows="" cols="" placeholder="备注"></textarea>
            </div>
        </div>
        <div style="position: absolute; bottom: 15px; left: 39%;">
            <button class="layui-btn" lay-submit="" lay-filter="addsubmit">
                <i class="layui-icon">&#x1005;</i>添加
            </button>
            <button class="layui-btn layui-bg-red cancel" type="button" onclick="myclose()">
                <i class="layui-icon">&#x1006;</i>取消
            </button>
        </div>
    </form>
</div>


<!--修改的div内容-->
<div id="editContent"
     style="display: none; height: 100%; height: 100%; text-align: center;">
    <form id="editform" lay-filter="editform"
          class="layui-form layui-form-pane"
          style="margin: 30px auto; display: inline-block;" >
        <input type="hidden" name="accountId"/>
        <input type="hidden" name="fundId"/>
        <div>
            <div class="layui-row">
                <div class="layui-col-xs6">
                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >银行卡号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="blankCardCode" lay-verify="required"
                                   disabled="disabled"       autocomplete="off" placeholder="请输入银行卡号" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >银行名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="blankName" lay-verify="required"
                                   autocomplete="off" placeholder="请输入账户名称" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >开户时间</label>
                        <div class="layui-input-inline">
                            <input type="text" id="addopen2" name="openTime" lay-verify="required"
                                   placeholder="请选择日期" class="layui-input">
                        </div>
                    </div>

                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >卡号利率</label>
                        <div class="layui-input-inline">
                            <input type="text" name="cardRate" lay-verify="required"
                                   autocomplete="off" placeholder="请输入利率%" class="layui-input">
                        </div>
                    </div>

                </div>
                <div class="layui-col-xs6">

                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >账户名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="accountName" lay-verify="required"
                                   autocomplete="off" placeholder="请输入账户名称" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >存款类型</label>
                        <div class="layui-input-inline">
                            <select name="deposit">
                                <option value="">请选择</option>
                                <option value="1">活期</option>
                                <option value="2">定期</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >结束时间</label>
                        <div class="layui-input-inline">
                            <input type="text" id="addend2" name="endTime" lay-verify="required"
                                   placeholder="请选择日期" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="text-align: center;">
                        <label class="layui-form-label layui-bg-green" >计息期间</label>
                        <div class="layui-input-inline">
                            <select  name="procisionDays">
                                <option value="">请选择</option>
                                <option value="1">360天</option>
                                <option value="2">365天</option>
                                <option value="3">366天</option>
                            </select>
                        </div>
                    </div>

                </div>
            </div>
            <div class="layui-form-item" style="text-align: center;">
                <div class="layui-input-inline">
                    <textarea name="accountDesc" style="width: 590px;height: 100px;padding: 10px;" rows="" cols="" placeholder="备注"></textarea>
                </div>
            </div>
        </div>
        <div style="position: absolute; bottom: 15px; left: 39%;">
            <button class="layui-btn" lay-submit="" lay-filter="editsubmit">
                <i class="layui-icon">&#x1005;</i>修改
            </button>
            <button class="layui-btn layui-bg-red cancel" type="button" onclick="myclose()">
                <i class="layui-icon">&#x1006;</i>取消
            </button>
        </div>
    </form>
</div>

</body>
</html>